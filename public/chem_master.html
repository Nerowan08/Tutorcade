<!DOCTYPE html>
<html lang="en" data-lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ChemÂ ClashÂ ArenaÂ v3</title>
<style>
:root{
  --bg1:#0d1321; --bg2:#1c2435; --panel:#182033; --accent:#60a5fa; --good:#4ade80;
  --warn:#eab308; --danger:#f87171; --radius:10px; --shadow:0 4px 18px rgba(0,0,0,.4);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
html,body{height:100%;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#e2e8f0;overflow:hidden}
button{cursor:pointer;border:none;border-radius:var(--radius);padding:.45rem .9rem;background:var(--panel);color:inherit;transition:.2s}
button:hover{filter:brightness(1.15)}
h2{font-size:1.2rem;margin-bottom:.4rem}

/* header */
header{display:flex;justify-content:space-between;align-items:center;padding:1rem 1.4rem;background:var(--panel);box-shadow:var(--shadow)}
.exit{background:var(--danger);color:#fff}

/* HUD */
#hud{display:flex;justify-content:center;gap:2.4rem;padding:.4rem 0;background:rgba(0,0,0,.15)}
#hud div{font-weight:600}

/* layout */
main{display:flex;flex-direction:column;height:calc(100% - 112px)}
#arena{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center}
#slots{display:grid;grid-template-columns:repeat(3,88px);grid-template-rows:repeat(2,120px);gap:12px;margin-bottom:1rem}
.slot{width:88px;height:120px;background:rgba(255,255,255,.05);border:2px dashed rgba(255,255,255,.15);
      border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;color:#666;
      transition:.2s}
.slot.hover{border-color:var(--accent);color:var(--accent)}
.slot .card{transform:none;border:none}

#handBar{background:var(--panel);padding:.6rem 1rem;display:flex;gap:.6rem;overflow-x:auto}
.card{min-width:60px;height:80px;background:#fff;color:#111;border-radius:6px;display:flex;
      flex-direction:column;align-items:center;justify-content:center;font-weight:600;user-select:none;
      box-shadow:var(--shadow);transition:.2s}
.card.drag{opacity:.4}
.card.compound{background:var(--accent);color:#fff}
.card:hover{transform:translateY(-4px)}

/* buttons */
#reactBtn{background:var(--accent);color:#fff;margin-left:1rem}

/* toast & modal */
#toastWrap{position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:2000}
.toast{margin-top:6px;padding:.6rem 1rem;border-radius:var(--radius);color:#fff;box-shadow:var(--shadow)}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
.shake{animation:shake .4s}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.78);display:flex;align-items:center;justify-content:center;z-index:1500}
.modalBox{background:var(--panel);padding:1.6rem;border-radius:var(--radius);max-width:330px;line-height:1.38;overflow:auto;max-height:85vh}

/* side panel */
aside{position:absolute;right:0;top:112px;bottom:0;width:260px;background:var(--panel);box-shadow:var(--shadow);
       display:flex;flex-direction:column}
.tabHead{display:flex}
.tabHead button{flex:1;border-bottom:2px solid transparent}
.tabHead button.active{border-color:var(--accent);background:rgba(255,255,255,.05)}
#sideBody{flex:1;overflow:auto;padding:1rem;font-size:.9rem}

/* table */
.pt-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.pt-cell{background:rgba(255,255,255,.06);padding:4px;border-radius:4px;text-align:center;font-size:.7rem;cursor:pointer}
.pt-cell:hover{background:var(--accent);color:#fff}

/* mobile */
@media(max-width:900px){
  aside{display:none}
  #slots{gap:8px}
  #handBar{padding:.5rem .6rem;gap:.4rem}
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <button id="langBtn">ä¸­æ–‡</button>
  <h1>ChemÂ ClashÂ Arena</h1>
  <div>
    <button id="helpBtn">?</button>
    <button id="resetBtn">Reset</button>
    <button class="exit" onclick="location.href='launcher.html'">Exit</button>
  </div>
</header>

<!-- HUD -->
<div id="hud">
  <div id="playerHUD"></div>
  <div id="energyHUD"></div>
  <div id="turnHUD"></div>
  <div id="cpuHUD"></div>
</div>

<!-- MAIN -->
<main>
  <!-- ARENA -->
  <section id="arena">
    <div id="slots"></div>
    <div style="display:flex;align-items:center">
      <button id="reactBtn">React!</button>
    </div>
  </section>
  <!-- HAND -->
  <div id="handBar"></div>
</main>

<!-- SIDE PANEL -->
<aside id="side">
  <div class="tabHead">
    <button data-tab="ach" class="active">Achievements</button>
    <button data-tab="pt">PeriodicÂ Table</button>
  </div>
  <div id="sideBody"></div>
</aside>

<!-- TOAST WRAP -->
<div id="toastWrap"></div>

<!-- DATA -->
<script id="elementsData" type="application/json">
[
 {"symbol":"H","name_en":"Hydrogen","name_zh":"æ°¢","atomic":1,"mass":1.008,"info":"Used in rocket fuel."},
 {"symbol":"O","name_en":"Oxygen","name_zh":"æ°§","atomic":8,"mass":15.999,"info":"Supports combustion."},
 {"symbol":"C","name_en":"Carbon","name_zh":"ç¢³","atomic":6,"mass":12.011,"info":"Basis of organic life."},
 {"symbol":"N","name_en":"Nitrogen","name_zh":"æ°®","atomic":7,"mass":14.007,"info":"78% of air."},
 {"symbol":"Na","name_en":"Sodium","name_zh":"é’ ","atomic":11,"mass":22.99,"info":"Reacts violently with water!"},
 {"symbol":"Cl","name_en":"Chlorine","name_zh":"æ°¯","atomic":17,"mass":35.45,"info":"Disinfectant gas."},
 {"symbol":"Fe","name_en":"Iron","name_zh":"é“","atomic":26,"mass":55.845,"info":"Core of steel."},
 {"symbol":"S","name_en":"Sulfur","name_zh":"ç¡«","atomic":16,"mass":32.06,"info":"Yellow nonâ€‘metal, used in sulfuric acid."},
 {"symbol":"P","name_en":"Phosphorus","name_zh":"ç£·","atomic":15,"mass":30.974,"info":"Essential element in DNA."},
 {"symbol":"Mg","name_en":"Magnesium","name_zh":"é•","atomic":12,"mass":24.305,"info":"Burns with bright white flame."},
 {"symbol":"Ca","name_en":"Calcium","name_zh":"é’™","atomic":20,"mass":40.078,"info":"Found in bones and teeth."},
 {"symbol":"K","name_en":"Potassium","name_zh":"é’¾","atomic":19,"mass":39.098,"info":"Vital for nerve function."}
]
</script>
<script id="recipesData" type="application/json">
[
 {"inputs":["H","H","O"],"product":"Water","formula":"Hâ‚‚O","damage":15,"desc":"Vital for life; universal solvent."},
 {"inputs":["Na","Cl"],"product":"Salt","formula":"NaCl","damage":18,"desc":"Seasoning & preservative."},
 {"inputs":["C","O","O"],"product":"Carbon Dioxide","formula":"COâ‚‚","damage":10,"desc":"Greenhouse gas exhaled by animals."},
 {"inputs":["N","H","H","H"],"product":"Ammonia","formula":"NHâ‚ƒ","damage":16,"desc":"Fertiliser & cleaning agent."},
 {"inputs":["Fe","C"],"product":"Steel Shard","formula":"Feâ€‘C","damage":20,"desc":"Basis of modern construction."},
 {"inputs":["H","H","S","O","O","O","O"],"product":"Sulfuric Acid","formula":"Hâ‚‚SOâ‚„","damage":25,"desc":"Strong acid, battery electrolyte."},
 {"inputs":["Ca","C","O","O","O"],"product":"Calcium Carbonate","formula":"CaCOâ‚ƒ","damage":14,"desc":"Limestone, antacid tablets."},
 {"inputs":["Mg","O"],"product":"Magnesium Oxide","formula":"MgO","damage":12,"desc":"Refractory ceramic material."},
 {"inputs":["K","Cl"],"product":"Potassium Chloride","formula":"KCl","damage":17,"desc":"Fertiliser & medical salt substitute."}
]
</script>

<script>
/*â”€â”€ helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
const $=s=>document.querySelector(s), $$=s=>document.querySelectorAll(s);
const elems=JSON.parse($('#elementsData').textContent);
const recipes=JSON.parse($('#recipesData').textContent);
const dict={
  en:{hp:'HP',turn:'Turn',time:'Time',energy:'Energy',react:'React!',reset:'Reset',
      help:'Drag a card into a â€œï¼‹â€ slot (cost 1â€¯âš¡).\nDoubleâ€‘click slot to reclaim.\nEnergy regenerates 3 per turn (maxÂ 10).\nConsecutive successful reactions increase combo multiplier.',
      win:'YouÂ Win!',lose:'YouÂ Lose!',combo:'COMBO Ã—',ach:'Achievements',pt:'Periodic Table'},
  zh:{hp:'ç”Ÿå‘½',turn:'å›åˆ',time:'æ—¶é—´',energy:'èƒ½é‡',react:'ååº”ï¼',reset:'é‡å¼€',
      help:'å°†å¡ç‰Œæ‹–å…¥â€œï¼‹â€æ§½ä½ï¼ˆæ¶ˆè€— 1 âš¡ï¼‰ã€‚\nåŒå‡»æ§½ä½é€€å›å¡ç‰Œã€‚\næ¯å›åˆæ¢å¤ 3 âš¡ï¼ˆä¸Šé™ 10ï¼‰ã€‚\nè¿ç»­æˆåŠŸååº”ä¼šæå‡è¿å‡»å€ç‡ã€‚',
      win:'ä½ èµ¢äº†ï¼',lose:'ä½ è¾“äº†ï¼',combo:'è¿å‡» Ã—',ach:'æˆå°±',pt:'å…ƒç´ è¡¨'}
};
let lang='en';function t(k){return dict[lang][k]||k}

/*â”€â”€ state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
const maxHand=8, slotCount=6, energyPerTurn=3;
let hand=[], slots=Array(slotCount).fill(null);
let playerHP, cpuHP, turn, timer, energy, combo, score;
let loop;
const lbKey='chemLB3'; let lb=JSON.parse(localStorage.getItem(lbKey)||'[]'); // {score,date}
const achKey='chemACH'; let ach=JSON.parse(localStorage.getItem(achKey)||'[]'); // array of strings

/*â”€â”€ DOM build â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function initSlots(){
  const wrap=$('#slots');wrap.innerHTML='';
  for(let i=0;i<slotCount;i++){
    const d=document.createElement('div');
    d.className='slot';d.dataset.idx=i;d.textContent='ï¼‹';
    d.ondblclick=()=>removeFromSlot(i);
    d.ondragover=e=>{e.preventDefault();d.classList.add('hover');};
    d.ondragleave=()=>d.classList.remove('hover');
    d.ondrop=e=>{
      e.preventDefault();d.classList.remove('hover');
      const id=e.dataTransfer.getData('id');
      const card=hand.find(c=>c.id===id);
      if(card && !slots[i]){
        if(energy<1){shake(d);toast('âš¡Â 0',varWarn=true);return;}
        energy--;placeIntoSlot(i,card);renderHUD();
      }else shake(d);
    };
    wrap.appendChild(d);
  }
}
function makeCard(sym){
  const c=document.createElement('div');c.className='card';c.textContent=sym;
  c.draggable=true;c.dataset.sym=sym;c.id=crypto.randomUUID();
  c.ondragstart=e=>{e.dataTransfer.setData('id',c.id);c.classList.add('drag');};
  c.ondragend=()=>c.classList.remove('drag');
  c.onclick=()=>showInfo(sym);
  return c;
}
function dealHand(){
  while(hand.length<maxHand){
    const sym=elems[Math.floor(Math.random()*elems.length)].symbol;
    hand.push({id:crypto.randomUUID(),sym});
  }
}
function renderHand(){
  const bar=$('#handBar');bar.innerHTML='';
  hand.forEach(card=>{
    const node=makeCard(card.sym);node.id=card.id;
    bar.appendChild(node);
  });
}
function renderSlots(){
  $$('div.slot').forEach(s=>{
    const idx=+s.dataset.idx;
    s.innerHTML='';
    if(slots[idx]){
      const node=makeCard(slots[idx].sym);
      node.draggable=false;
      s.appendChild(node);
    }else s.textContent='ï¼‹';
  });
}
function renderHUD(){
  $('#playerHUD').textContent=`ğŸ‘¤Â ${t('hp')}:Â ${playerHP}`;
  $('#cpuHUD').textContent=`ğŸ¤–Â ${t('hp')}:Â ${cpuHP}`;
  $('#turnHUD').textContent=`${t('turn')}Â ${turn} | ${t('time')}:Â ${timer}s`;
  $('#energyHUD').textContent=`âš¡Â ${t('energy')}:Â ${energy}`;
}

/*â”€â”€ slot ops â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function placeIntoSlot(i,card){
  slots[i]=card;
  hand=hand.filter(c=>c!==card);
  renderHand();renderSlots();
}
function removeFromSlot(i){
  if(slots[i]){hand.push(slots[i]);slots[i]=null;renderHand();renderSlots();energy++;renderHUD();}
}
function shake(node){node.classList.add('shake');setTimeout(()=>node.classList.remove('shake'),400);}

/*â”€â”€ reactioné€»è¾‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function react(){
  const filled=slots.filter(Boolean);
  if(!filled.length)return;
  const symbols=filled.map(c=>c.sym).sort();
  const recipe=recipes.find(r=>eqArr(symbols,r.inputs.slice().sort()));
  if(recipe){
    let dmg=Math.round(recipe.damage*combo);
    cpuHP=Math.max(cpuHP-dmg,0);
    toast(`${recipe.product}Â â€‘${dmg}`,false);
    compoundModal(recipe);
    combo+=0.2;combo=Math.min(combo,2);
    slots.fill(null);renderSlots();
    achievementCheck('firstReact');
  }else{toast('NoÂ Reaction',true);combo=1;}
  cpuAttack();advanceTurn();
}
function cpuAttack(){
  const dmg=Math.floor(Math.random()*10)+8;
  playerHP=Math.max(playerHP-dmg,0);
  toast(`ğŸ¤–Â -${dmg}`,true);
}
function advanceTurn(){
  turn++;timer=30;energy=Math.min(energy+energyPerTurn,10);
  dealHand();renderHand();renderHUD();
  checkOutcome();
}
function checkOutcome(){
  if(playerHP<=0||cpuHP<=0){
    clearInterval(loop);
    if(playerHP>0){toast(t('win'));saveScore();achievementCheck('firstWin');}
    else toast(t('lose'),true);
  }
}

/*â”€â”€ toast system â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function toast(msg,isWarn=false){
  const wrap=$('#toastWrap');
  const d=document.createElement('div');d.className='toast';
  d.style.background=isWarn? (isWarn===true? 'var(--warn)':'var(--danger)') : 'var(--good)';
  d.textContent=msg;wrap.appendChild(d);
  setTimeout(()=>d.remove(),1600);
}

/*â”€â”€ compound info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function compoundModal(r){
  const overlay=document.createElement('div');overlay.className='modal';
  const box=document.createElement('div');box.className='modalBox';
  box.innerHTML=`<h3>${r.product}</h3>
    <p><b>Formula:</b>Â ${r.formula}</p>
    <p>${r.desc}</p>
    <button style="margin-top:.8rem" onclick="this.parentNode.parentNode.remove()">OK</button>`;
  overlay.appendChild(box);document.body.appendChild(overlay);
}

/*â”€â”€ periodic table & achievement panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function renderSide(tab='ach'){
  const body=$('#sideBody');body.innerHTML='';
  $$('aside .tabHead button').forEach(b=>b.classList.toggle('active',b.dataset.tab===tab));
  if(tab==='ach'){
    const list=ach.length? ach.map(a=>`<li>ğŸ†Â ${a}</li>`).join(''):'<li>â€‘</li>';
    body.innerHTML=`<h3>${t('ach')}</h3><ul>${list}</ul>`;
  }else{
    const grid=document.createElement('div');grid.className='pt-grid';
    elems.forEach(e=>{
      const cell=document.createElement('div');cell.className='pt-cell';cell.textContent=e.symbol;
      cell.title=e['name_'+lang];
      cell.onclick=()=>showInfo(e.symbol);
      grid.appendChild(cell);
    });body.appendChild(grid);
  }
}
/*â”€â”€ achievements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function achievementCheck(key){
  const map={
    firstReact:'First Reaction',
    firstWin:'First Victory',
    combo3:'ComboÂ Ã—1.6',
    rich:'EnergyÂ Master',
    handsFull:'FullÂ Hand'
  };
  if(!ach.includes(map[key])){
    ach.push(map[key]);localStorage.setItem(achKey,JSON.stringify(ach));
    toast(`ğŸ†Â ${map[key]}`);
    renderSide('ach');
  }
}

/*â”€â”€ info modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function showInfo(sym){
  const meta=elems.find(e=>e.symbol===sym);
  const overlay=document.createElement('div');overlay.className='modal';
  const box=document.createElement('div');box.className='modalBox';
  box.innerHTML=`<h3>${meta['name_'+lang]}</h3>
    <p>${lang==='en'?'Symbol':'ç¬¦å·'}:Â <b>${meta.symbol}</b></p>
    <p>${lang==='en'?'Atomic â„–':'åŸå­åºæ•°'}:Â ${meta.atomic}</p>
    <p>${lang==='en'?'Atomic mass':'ç›¸å¯¹åŸå­è´¨é‡'}:Â ${meta.mass}</p>
    <p>${meta.info}</p>
    <button style="margin-top:.8rem" onclick="this.parentNode.parentNode.remove()">OK</button>`;
  overlay.appendChild(box);document.body.appendChild(overlay);
}

/*â”€â”€ utils â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function eqArr(a,b){return JSON.stringify(a)===JSON.stringify(b);}
function tick(){if(timer>0){timer--;renderHUD();}else{cpuAttack();advanceTurn();}}
function saveScore(){lb.push({score,date:new Date().toLocaleDateString()});
  lb.sort((a,b)=>b.score-a.score);lb=lb.slice(0,10);localStorage.setItem(lbKey,JSON.stringify(lb));}

/*â”€â”€ help â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function help(){alert(t('help'));}

/*â”€â”€ event bindings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
$('#reactBtn').onclick=react;
$('#resetBtn').onclick=()=>{clearInterval(loop);start();}
$('#langBtn').onclick=()=>{
  lang=lang==='en'?'zh':'en';
  $('#langBtn').textContent=lang==='en'?'ä¸­æ–‡':'EN';
  $('#reactBtn').textContent=t('react');$('#resetBtn').textContent=t('reset');
  renderHUD();renderSide(document.querySelector('aside .tabHead button.active').dataset.tab);
};
$('#helpBtn').onclick=help;
$$('aside .tabHead button').forEach(b=>b.onclick=()=>renderSide(b.dataset.tab));

/*â”€â”€ start / restart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
function start(){
  hand=[];slots=Array(slotCount).fill(null);
  playerHP=100;cpuHP=100;turn=1;timer=30;energy=10;combo=1;score=0;
  $('#reactBtn').textContent=t('react');dealHand();initSlots();
  renderHand();renderSlots();renderHUD();renderSide('ach');
  clearInterval(loop);loop=setInterval(tick,1000);
  setTimeout(help,600);
}

/*â”€â”€ boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€*/
start();
</script>
</body>
</html>
